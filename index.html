<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>3Dè™šæ‹Ÿå±•å…</title><style>#loadingScreen{position:fixed;top:0;left:0;width:100%;height:100%;z-index:2000;display:flex;justify-content:center;align-items:center;background-color:#fff}#loadingBackground{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;background-repeat:no-repeat}#loadingContent{position:relative;z-index:2;text-align:center;color:#2c3e50;max-width:800px;width:90%}#loadingTitle{font-size:4.5em;font-weight:700;margin-bottom:50px;font-family:'Arial Black',sans-serif;letter-spacing:2px;text-shadow:2px 2px 4px rgba(0,0,0,.2);color:#2c3e50}#progressContainer{width:80%;max-width:500px;margin:0 auto 20px;background-color:rgba(255,255,255,.7);border-radius:10px;overflow:hidden;box-shadow:0 4px 6px rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.1);height:20px}#progressBar{width:0%;height:100%;background:linear-gradient(to right,#3498db,#2980b9);transition:width .3s ease,background .5s ease;box-shadow:0 0 10px rgba(52,152,219,.3)}#progressText{font-size:1.2em;font-weight:700;color:#2c3e50;margin-top:10px}#loadingHint{font-size:.9em;color:#7f8c8d;margin-top:30px;font-style:italic}body.loaded #loadingScreen{opacity:0;visibility:hidden;transition:opacity .5s ease,visibility .5s}body.loaded .click-to-start{display:block}body{margin:0;overflow:hidden;background:linear-gradient(to bottom,#87ceeb,#e6f7ff);cursor:none}canvas{display:block}.info{position:fixed;top:10px;left:10px;color:#333;font-family:Arial,sans-serif;font-size:14px;background:rgba(255,255,255,.9);padding:12px;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,.1);max-width:320px;z-index:100}.info p{margin:4px 0}.info .title{font-weight:700;margin-bottom:6px;color:#2c3e50}.info .highlight{color:#e74c3c;font-weight:700}.info .perspective{color:#3498db;font-weight:700}.cursor-dot{position:fixed;top:50%;left:50%;width:8px;height:8px;background-color:rgba(255,255,255,.9);border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:1000;box-shadow:0 0 6px rgba(0,0,0,.8);border:1px solid rgba(0,0,0,.3);display:none}.click-to-start{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:rgba(0,0,0,.8);color:#fff;padding:15px 30px;border-radius:8px;font-family:Arial,sans-serif;font-size:16px;z-index:1001;cursor:pointer;text-align:center;box-shadow:0 0 15px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.2);display:none}.click-to-start:hover{background-color:rgba(30,30,30,.9)}.perspective-indicator{position:fixed;top:10px;right:10px;background-color:rgba(0,0,0,.9);color:#fff;padding:8px 12px;border-radius:6px;font-family:Arial,sans-serif;font-size:14px;z-index:100;box-shadow:0 0 8px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2)}.music-indicator{position:fixed;top:50px;right:10px;background-color:rgba(0,0,0,.9);color:#fff;padding:8px 12px;border-radius:6px;font-family:Arial,sans-serif;font-size:12px;z-index:100;box-shadow:0 0 8px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2);cursor:default;transition:all .3s ease;display:flex;align-items:center;max-width:300px}.music-indicator:hover{background-color:rgba(0,0,0,.9);transform:none;box-shadow:0 0 8px rgba(0,0,0,.3)}.music-icon{margin-right:8px;font-size:14px}.music-playing{color:#4caf50}.music-paused{color:#ff9800}.music-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}.exhibit-info{position:fixed;top:50%;right:20px;transform:translateY(-50%);background-color:rgba(0,0,0,.8);color:#fff;padding:20px;border-radius:10px;font-family:Arial,sans-serif;font-size:16px;width:380px;max-height:400px;overflow-y:auto;z-index:1002;box-shadow:0 0 20px rgba(0,0,0,.7);border:2px solid rgba(255,255,255,.2);opacity:0;transition:opacity .3s ease;pointer-events:none}.exhibit-info.show{opacity:1;pointer-events:auto}.exhibit-info-name{font-size:22px;font-weight:700;margin-bottom:12px;color:#ff8c00;text-align:center;padding-bottom:8px;border-bottom:2px solid rgba(255,140,0,.3);text-shadow:0 0 5px rgba(255,140,0,.3)}.exhibit-info-content{line-height:1.6;text-align:justify;font-size:15px;color:#f0f0f0}.exhibit-info::-webkit-scrollbar{width:8px}.exhibit-info::-webkit-scrollbar-track{background:rgba(255,255,255,.1);border-radius:4px}.exhibit-info::-webkit-scrollbar-thumb{background:rgba(255,140,0,.5);border-radius:4px}.exhibit-info::-webkit-scrollbar-thumb:hover{background:rgba(255,140,0,.7)}</style></head><body><div id="loadingScreen"><div id="loadingBackground"></div><div id="loadingContent"><h1 id="loadingTitle">Virtual Hall</h1><div id="progressContainer"><div id="progressBar"></div></div><div id="progressText">åŠ è½½ä¸­... 0%</div><div id="loadingHint">æ­£åœ¨å‡†å¤‡æ‚¨çš„3Dè™šæ‹Ÿå±•å…ä½“éªŒ</div></div></div><div class="info"><p class="title">ğŸ® 3Dè™šæ‹Ÿå±•å…æ“ä½œè¯´æ˜</p><p>â€¢ <span class="highlight">WASDé”®</span> - æ§åˆ¶ç©å®¶ç§»åŠ¨</p><p>â€¢ <span class="highlight">é¼ æ ‡ç§»åŠ¨</span> - æ—‹è½¬è§†è§’</p><p>â€¢ <span class="highlight">ç©ºæ ¼é”®</span> - ç©å®¶ä¸Šå‡ | <span class="highlight">Shifté”®</span> - ç©å®¶ä¸‹é™</p><p>â€¢ <span class="highlight">Vé”®</span> - <span class="perspective">åˆ‡æ¢ç¬¬ä¸€äººç§°/ç¬¬ä¸‰äººç§°è§†è§’</span></p><p>â€¢ <span class="highlight">Mé”®</span> - æš‚åœ/æ’­æ”¾èƒŒæ™¯éŸ³ä¹</p><p>â€¢ <span class="highlight">ESCé”®</span> - é€€å‡ºé¼ æ ‡é”å®šæ¨¡å¼</p><p>â€¢ <span class="highlight">å±•å“ä»‹ç»</span>ï¼šç¬¬ä¸€äººç§°è§†è§’ä¸‹ï¼Œå‡†æ˜Ÿå¯¹å‡†å±•å“æ—¶æ˜¾ç¤ºä»‹ç»</p><p>â€¢ <span class="highlight">èƒŒæ™¯éŸ³ä¹</span>ï¼šç‚¹å‡»"å¼€å§‹æ§åˆ¶"åè‡ªåŠ¨æ’­æ”¾ï¼ŒæŒ‰Mé”®æ§åˆ¶æ’­æ”¾/æš‚åœ</p></div><div class="cursor-dot" id="cursorDot"></div><div class="click-to-start" id="clickToStart">ç‚¹å‡»æ­¤å¤„å¼€å§‹æ§åˆ¶</div><div class="perspective-indicator" id="perspectiveIndicator">ç¬¬ä¸€äººç§°è§†è§’</div><div class="music-indicator" id="musicIndicator"><span class="music-icon" id="musicIcon">â–¶ï¸</span> <span class="music-name" id="musicName">åŠ è½½ä¸­...</span></div><div class="exhibit-info" id="exhibitInfo"><div class="exhibit-info-name" id="exhibitInfoName">å±•å“åç§°</div><div class="exhibit-info-content" id="exhibitInfoContent">å±•å“ä»‹ç»å†…å®¹</div></div><script src="libs/three.min.js"></script><script src="libs/GLTFLoader.js"></script><script src="libs/DRACOLoader.js"></script><script>function setupLoadingBackground(){const e=document.getElementById("loadingBackground"),o="pictures/background.png",t="pictures/background.jpg",n=new Image;n.onload=function(){e.style.backgroundImage=`url('${o}')`},n.onerror=function(){const o=new Image;o.onload=function(){e.style.backgroundImage=`url('${t}')`},o.onerror=function(){console.log("æœªæ‰¾åˆ°èƒŒæ™¯å›¾ç‰‡ï¼Œä½¿ç”¨ç™½è‰²èƒŒæ™¯")},o.src=t},n.src=o}setupLoadingBackground(),setTimeout(()=>{updateLoadingProgress(5)},100);let totalModelsToLoad=21,loadedModelsCount=0,totalProgress=0,currentLoadingStep=0,smoothProgress=0,currentStepProgress=0;function updateLoadingProgress(e){const o=document.getElementById("progressBar"),t=document.getElementById("progressText"),n=document.getElementById("loadingHint"),i=()=>{let a="",s=0;const r=smoothProgress;if(r<=5)a="åˆå§‹åŒ–åœºæ™¯",s=r/5*100;else if(r<=20)a="åŠ è½½äººç‰©æ¨¡å‹",s=(r-5)/15*100;else if(r<=90){a="åŠ è½½å±•å“æ¨¡å‹";s=loadedModelsCount/totalModelsToLoad*100,loadedModelsCount<=totalModelsToLoad&&(n.textContent=`æ­£åœ¨åŠ è½½æ¨¡å‹ ${loadedModelsCount}/${totalModelsToLoad}...`)}else r<=95?(a="åˆå§‹åŒ–å…‰æº",s=(r-90)/5*100):(a="è®¾ç½®äº¤äº’ç³»ç»Ÿ",s=(r-95)/5*100);const c=a?` | ${a}: ${Math.round(s)}%`:"";smoothProgress<e?(smoothProgress=Math.min(smoothProgress+.5,e),o.style.width=smoothProgress+"%",t.textContent=`åŠ è½½ä¸­... ${Math.round(smoothProgress)}%${c}`,updateProgressBarColor(smoothProgress),requestAnimationFrame(i)):(smoothProgress=e,o.style.width=smoothProgress+"%",t.textContent=`åŠ è½½ä¸­... ${Math.round(smoothProgress)}%${c}`,smoothProgress>=100&&onLoadingComplete())};i()}function updateProgressBarColor(e){const o=document.getElementById("progressBar");o.style.background=e<30?"linear-gradient(to right, #3498db, #2980b9)":e<70?"linear-gradient(to right, #2ecc71, #27ae60)":e<90?"linear-gradient(to right, #e67e22, #d35400)":"linear-gradient(to right, #2ecc71, #27ae60)"}function onModelLoaded(e=""){loadedModelsCount++;const o=loadedModelsCount/totalModelsToLoad*70,t=Math.min(20+o,90);updateLoadingProgress(t),console.log(`âœ… æ¨¡å‹ ${loadedModelsCount}/${totalModelsToLoad} åŠ è½½å®Œæˆ${e?`: ${e}`:""}`),loadedModelsCount>=totalModelsToLoad&&setTimeout(()=>{simulateFinalLoading()},500)}function simulateFinalLoading(){let e=90;const o=setInterval(()=>{e+=2,updateLoadingProgress(Math.min(e,100));const t=document.getElementById("loadingHint");e<95?t.textContent="æ­£åœ¨åˆå§‹åŒ–å…‰æºç³»ç»Ÿ...":e<100?t.textContent="æ­£åœ¨è®¾ç½®äº¤äº’ç³»ç»Ÿ...":(t.textContent="å‡†å¤‡è¿›å…¥è™šæ‹Ÿå±•å…...",clearInterval(o))},100)}function onLoadingComplete(){setTimeout(function(){document.body.classList.add("loaded");document.getElementById("clickToStart").style.display="block";document.getElementById("loadingHint").textContent="æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ä½“éªŒ",console.log("âœ… æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼Œå‡†å¤‡è¿›å…¥å±•å…"),celebrateCompletion()},800)}function celebrateCompletion(){const e=document.getElementById("progressBar");e.style.transition="all 0.5s ease",setTimeout(()=>{e.style.boxShadow="0 0 20px rgba(46, 204, 113, 0.8)"},100),setTimeout(()=>{e.style.boxShadow="none"},600)}const musicFolder="music";let backgroundMusic=null,isMusicPlaying=!1,currentMusicIndex=0,musicFiles=["ç¯ç«é‡Œçš„ä¸­å›½ é’¢ç´ç‰ˆ.mp3"];const musicIndicator=document.getElementById("musicIndicator"),musicIcon=document.getElementById("musicIcon"),musicName=document.getElementById("musicName");function initBackgroundMusic(){console.log("ğŸµ åˆå§‹åŒ–èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿ...");try{backgroundMusic=new Audio,backgroundMusic.loop=!0,backgroundMusic.volume=.5,loadMusicFiles(),backgroundMusic.addEventListener("play",()=>{updateMusicUI(!0)}),backgroundMusic.addEventListener("pause",()=>{updateMusicUI(!1)}),backgroundMusic.addEventListener("ended",()=>{playNextMusic()}),console.log("âœ… èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")}catch(e){console.error("âŒ èƒŒæ™¯éŸ³ä¹åˆå§‹åŒ–å¤±è´¥:",e),musicName.textContent="éŸ³ä¹æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥",musicIndicator.style.display="none"}}function loadMusicFiles(){musicFiles=["ç¯ç«é‡Œçš„ä¸­å›½ é’¢ç´ç‰ˆ.mp3"],console.log(`ğŸµ å‘ç° ${musicFiles.length} ä¸ªéŸ³ä¹æ–‡ä»¶`),musicFiles.length>0?playMusicByIndex(0):(musicName.textContent="æœªæ‰¾åˆ°éŸ³ä¹æ–‡ä»¶",musicIcon.style.display="none")}function playMusicByIndex(e){if(!backgroundMusic||e<0||e>=musicFiles.length)return;currentMusicIndex=e;const o=musicFiles[e],t=`music/${o}`;console.log(`ğŸµ å°è¯•æ’­æ”¾: ${t}`),backgroundMusic.src=t,isMusicPlaying&&backgroundMusic.play().catch(e=>{console.log("âš ï¸ è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:",e),musicName.textContent="ç‚¹å‡»æ’­æ”¾éŸ³ä¹",musicIcon.textContent="â¸ï¸"});const n=o.replace(/\.[^/.]+$/,"").replace(/_/g," ");musicName.textContent=n}function playNextMusic(){0!==musicFiles.length&&(currentMusicIndex=(currentMusicIndex+1)%musicFiles.length,playMusicByIndex(currentMusicIndex),isMusicPlaying&&backgroundMusic.play().catch(e=>{console.log("åˆ‡æ¢éŸ³ä¹åæ’­æ”¾å¤±è´¥:",e)}))}function toggleMusicPlayback(){backgroundMusic&&(isMusicPlaying?(backgroundMusic.pause(),isMusicPlaying=!1):backgroundMusic.play().then(()=>{isMusicPlaying=!0}).catch(e=>{console.log("æ’­æ”¾å¤±è´¥:",e),musicName.textContent="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹"}))}function startMusicPlayback(){backgroundMusic&&0!==musicFiles.length&&backgroundMusic.play().then(()=>{isMusicPlaying=!0,console.log("ğŸµ èƒŒæ™¯éŸ³ä¹å¼€å§‹æ’­æ”¾")}).catch(e=>{console.log("âš ï¸ è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:",e),musicName.textContent="ç‚¹å‡»æ­¤å¤„æ’­æ”¾éŸ³ä¹",musicIcon.textContent="â–¶ï¸"})}function updateMusicUI(e){isMusicPlaying=e,e?(musicIcon.textContent="ğŸµ",musicIcon.className="music-icon music-playing",musicIndicator.title="ç‚¹å‡»æš‚åœéŸ³ä¹"):(musicIcon.textContent="â¸ï¸",musicIcon.className="music-icon music-paused",musicIndicator.title="ç‚¹å‡»æ’­æ”¾éŸ³ä¹")}const scene=new THREE.Scene;scene.background=new THREE.Color(15136767);const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.set(0,1.5,5);const renderer=new THREE.WebGLRenderer({antialias:!1,alpha:!1,precision:"lowp"});renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap;const rendererCanvas=renderer.domElement;document.body.appendChild(rendererCanvas);let perspectiveMode="first";const perspectiveIndicator=document.getElementById("perspectiveIndicator");document.addEventListener("keydown",e=>{switch(" "===e.key&&e.preventDefault(),e.key.toLowerCase()){case"w":keyStates.w=!0;break;case"a":keyStates.a=!0;break;case"s":keyStates.s=!0;break;case"d":keyStates.d=!0;break;case" ":keyStates.space=!0;break;case"shift":keyStates.shift=!0;break;case"m":toggleMusicPlayback();break;case"v":"first"===perspectiveMode?(perspectiveMode="third",perspectiveIndicator.textContent="ç¬¬ä¸‰äººç§°è§†è§’"):(perspectiveMode="first",perspectiveIndicator.textContent="ç¬¬ä¸€äººç§°è§†è§’")}});let isMouseLocked=!1;const cursorDot=document.getElementById("cursorDot"),clickToStart=document.getElementById("clickToStart");function requestPointerLock(){rendererCanvas.requestPointerLock=rendererCanvas.requestPointerLock||rendererCanvas.mozRequestPointerLock||rendererCanvas.webkitRequestPointerLock,rendererCanvas.requestPointerLock()}function exitPointerLock(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock()}function pointerLockChange(){document.pointerLockElement===rendererCanvas||document.mozPointerLockElement===rendererCanvas||document.webkitPointerLockElement===rendererCanvas?(isMouseLocked=!0,cursorDot.style.display="block",clickToStart.style.display="none"):(isMouseLocked=!1,cursorDot.style.display="none",clickToStart.style.display="block")}clickToStart.addEventListener("click",()=>{requestPointerLock(),startMusicPlayback()}),rendererCanvas.addEventListener("click",()=>{isMouseLocked||(requestPointerLock(),startMusicPlayback())}),document.addEventListener("keydown",e=>{"Escape"===e.key&&exitPointerLock()}),document.addEventListener("pointerlockchange",pointerLockChange,!1),document.addEventListener("mozpointerlockchange",pointerLockChange,!1),document.addEventListener("webkitpointerlockchange",pointerLockChange,!1);let targetRotationX=Math.PI,targetRotationY=0,currentRotationX=Math.PI,currentRotationY=0;const cameraDistance=8,cameraHeight=1,firstPersonHeight=1.5,sensitivity=.002;document.addEventListener("mousemove",e=>{if(!isMouseLocked)return;const o=e.movementX||e.mozMovementX||e.webkitMovementX||0,t=e.movementY||e.mozMovementY||e.webkitMovementY||0;targetRotationX-=.002*o,targetRotationY+=.002*t,targetRotationY=Math.max(-Math.PI/2+.1,Math.min(Math.PI/2-.1,targetRotationY))});const player=new THREE.Object3D;player.position.set(0,.5,0),scene.add(player);const characterLoader=new THREE.GLTFLoader;let characterModel=null;characterLoader.load("3d_models/character.glb",e=>{characterModel=e.scene,characterModel.scale.set(2,2,2),characterModel.position.y=-.3,characterModel.rotation.y=Math.PI,characterModel.traverse(e=>{if(e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,e.material)){const o=e.material.clone();if(o.emissive=new THREE.Color(3355443),o.emissiveIntensity=.3,o.color){const e=o.color.clone().multiplyScalar(1.5);o.color=e}e.material=o}}),player.add(characterModel),console.log("âœ… äººç‰©æ¨¡å‹åŠ è½½æˆåŠŸï¼Œå·²åº”ç”¨ä¼˜åŒ–è®¾ç½®"),onModelLoaded("äººç‰©æ¨¡å‹")},e=>{const o=Math.round(e.loaded/e.total*100);console.log(`äººç‰©æ¨¡å‹åŠ è½½è¿›åº¦ï¼š${o}%`)},e=>{console.log("âŒ äººç‰©æ¨¡å‹åŠ è½½å¤±è´¥ (è·¯å¾„: 3d_models/character.glb)ï¼Œä½¿ç”¨é»˜è®¤æ–¹å—",e);const o=new THREE.BoxGeometry(.8,1.8,.8),t=new THREE.MeshStandardMaterial({color:16729156,metalness:.1,roughness:.7,emissive:3355443,emissiveIntensity:.3});characterModel=new THREE.Mesh(o,t),characterModel.position.y=1.1,characterModel.rotation.y=Math.PI,characterModel.castShadow=!1,player.add(characterModel),onModelLoaded("äººç‰©æ¨¡å‹(å›é€€)")});const firstPersonHand=new THREE.Mesh(new THREE.BoxGeometry(.3,.3,.6),new THREE.MeshBasicMaterial({color:3355443}));firstPersonHand.position.set(.3,-.2,-.5),firstPersonHand.visible=!1,camera.add(firstPersonHand);const keyStates={w:!1,a:!1,s:!1,d:!1,space:!1,shift:!1};document.addEventListener("keydown",e=>{switch(" "===e.key&&e.preventDefault(),e.key.toLowerCase()){case"w":keyStates.w=!0;break;case"a":keyStates.a=!0;break;case"s":keyStates.s=!0;break;case"d":keyStates.d=!0;break;case" ":keyStates.space=!0;break;case"shift":keyStates.shift=!0}}),document.addEventListener("keyup",e=>{switch(e.key.toLowerCase()){case"w":keyStates.w=!1;break;case"a":keyStates.a=!1;break;case"s":keyStates.s=!1;break;case"d":keyStates.d=!1;break;case" ":keyStates.space=!1;break;case"shift":keyStates.shift=!1}});const moveSpeed=.18,verticalSpeed=.15,groundBounds={minX:-50,maxX:50,minZ:-50,maxZ:50,minY:.5,maxY:20};function updatePlayerMovement(){const e=new THREE.Vector3(Math.sin(currentRotationX),0,Math.cos(currentRotationX)).normalize(),o=new THREE.Vector3(-Math.cos(currentRotationX),0,Math.sin(currentRotationX)).normalize(),t=new THREE.Vector3(0,0,0);keyStates.w&&t.add(e),keyStates.s&&t.sub(e),keyStates.d&&t.add(o),keyStates.a&&t.sub(o),t.length()>0&&(t.normalize(),player.position.add(t.multiplyScalar(.18))),player.position.x=Math.max(groundBounds.minX,Math.min(groundBounds.maxX,player.position.x)),player.position.z=Math.max(groundBounds.minZ,Math.min(groundBounds.maxZ,player.position.z)),keyStates.space&&(player.position.y+=.15),keyStates.shift&&(player.position.y-=.15),player.position.y=Math.max(groundBounds.minY,Math.min(groundBounds.maxY,player.position.y))}function updateCamera(){if(currentRotationX+=.1*(targetRotationX-currentRotationX),currentRotationY+=.1*(targetRotationY-currentRotationY),"first"===perspectiveMode){const e=player.position.x,o=player.position.y+1.5,t=player.position.z;camera.position.set(e,o,t);const n=e+Math.sin(currentRotationX)*Math.cos(currentRotationY),i=o-Math.sin(currentRotationY),a=t+Math.cos(currentRotationX)*Math.cos(currentRotationY);camera.lookAt(n,i,a),firstPersonHand.visible=!0,characterModel&&(characterModel.visible=!1)}else{const e=player.position.x-8*Math.sin(currentRotationX)*Math.cos(currentRotationY),o=player.position.y+1+8*Math.sin(currentRotationY),t=player.position.z-8*Math.cos(currentRotationX)*Math.cos(currentRotationY);if(camera.position.set(e,o,t),camera.lookAt(player.position.x,player.position.y+1,player.position.z),firstPersonHand.visible=!1,characterModel){characterModel.visible=!0;const e=.1;let o=currentRotationX-characterModel.rotation.y;o>Math.PI&&(o-=2*Math.PI),o<-Math.PI&&(o+=2*Math.PI),characterModel.rotation.y+=o*e}}}const groundConfig={length:100,width:100,color:16119285},floorGeo=new THREE.PlaneGeometry(groundConfig.length,groundConfig.width),floorMat=new THREE.MeshStandardMaterial({color:groundConfig.color,roughness:.8,metalness:.05}),floor=new THREE.Mesh(floorGeo,floorMat);floor.rotation.x=-Math.PI/2,floor.position.y=0,floor.receiveShadow=!0,scene.add(floor);const gridHelper=new THREE.GridHelper(100,100,13421772,15658734);gridHelper.position.y=.01,scene.add(gridHelper);const boundaryLineMaterial=new THREE.LineBasicMaterial({color:16711680}),boundaryPoints=[];boundaryPoints.push(new THREE.Vector3(groundBounds.minX,.1,groundBounds.minZ)),boundaryPoints.push(new THREE.Vector3(groundBounds.maxX,.1,groundBounds.minZ)),boundaryPoints.push(new THREE.Vector3(groundBounds.maxX,.1,groundBounds.maxZ)),boundaryPoints.push(new THREE.Vector3(groundBounds.minX,.1,groundBounds.maxZ)),boundaryPoints.push(new THREE.Vector3(groundBounds.minX,.1,groundBounds.minZ));const boundaryGeometry=(new THREE.BufferGeometry).setFromPoints(boundaryPoints),boundaryLine=new THREE.Line(boundaryGeometry,boundaryLineMaterial);scene.add(boundaryLine);const cornerGeometry=new THREE.BoxGeometry(.5,1,.5),cornerMaterial=new THREE.MeshBasicMaterial({color:16711680}),cornerPositions=[{x:groundBounds.minX,z:groundBounds.minZ},{x:groundBounds.maxX,z:groundBounds.minZ},{x:groundBounds.maxX,z:groundBounds.maxZ},{x:groundBounds.minX,z:groundBounds.maxZ}];cornerPositions.forEach(e=>{const o=new THREE.Mesh(cornerGeometry,cornerMaterial);o.position.set(e.x,.5,e.z),scene.add(o)});const totalExhibits=20,modelFolder="3d_models",introductionFolder="introduction",exhibitGapX=18,exhibitGapZ=18,modelScale=3,modelY=2,unifiedTiltAngle=-.3,modelSelfIllumination=!0,modelEmissiveIntensity=1.5,modelBrightnessBoost=5,cols=5,rows=Math.ceil(4),startX=-36,startZ=18*-(rows-1)/2,loader=new THREE.GLTFLoader,dracoLoader=new THREE.DRACOLoader;dracoLoader.setDecoderPath("libs/"),loader.setDRACOLoader(dracoLoader),characterLoader.setDRACOLoader(dracoLoader);const exhibitGeo=new THREE.BoxGeometry(2.5,3,2.5),exhibitMat=new THREE.MeshStandardMaterial({color:4491519,roughness:.6,metalness:.15});function enhanceModelOnly(e){return e.traverse(e=>{if(e.isMesh){const o=e.material;if(Array.isArray(o)){const t=o.map(e=>enhanceSingleMaterial(e));e.material=t}else e.material=enhanceSingleMaterial(o);e.castShadow=!0,e.receiveShadow=!0}}),e}function enhanceSingleMaterial(e){let o;if(e){if(o=e.clone(),o.color){const e=o.color.clone().multiplyScalar(5);o.color=e}o.emissive||(o.emissive=o.color?o.color.clone().multiplyScalar(.5):new THREE.Color(8947848)),o.emissiveIntensity=1.5,o.roughness=Math.min(o.roughness||.5,.3),o.metalness=Math.max(o.metalness||0,.1),o.needsUpdate=!0}else o=new THREE.MeshStandardMaterial({color:16777215,roughness:.3,metalness:.1,emissive:16777215,emissiveIntensity:1.5});return o}function addModelSpecificLights(e){const o=(new THREE.Box3).setFromObject(e),t=o.getSize(new THREE.Vector3),n=o.getCenter(new THREE.Vector3),i=Math.max(t.x,t.y,t.z),a=new THREE.Vector3(0,.3,1).normalize(),s=new THREE.PointLight(16777215,4,3*i);s.position.copy(n).add(a.multiplyScalar(1.5*i)),e.add(s);const r=new THREE.PointLight(16777215,2.5,3*i);r.position.set(n.x,n.y+1.2*i,n.z),e.add(r);const c=new THREE.PointLight(16777215,1.5,2*i);return c.position.set(n.x-1.2*i,n.y+.5*i,n.z),e.add(c),e}const glbModels=[];function loadExhibitInfo(e){return fetch(`introduction/${e}.txt`).then(o=>{if(!o.ok)throw new Error(`æ— æ³•åŠ è½½ä»‹ç»æ–‡ä»¶: introduction/${e}.txt`);return o.text()}).then(o=>{const t=o.split("\n").filter(e=>""!==e.trim());let n=`å±•å“ ${e}`,i="æš‚æ— è¯¦ç»†ä»‹ç»";return t.length>0&&(n=t[0].trim(),t.length>1&&(i=t.slice(1).join("\n").trim())),{name:n,content:i}}).catch(o=>(console.log(`å±•å“${e}çš„ä»‹ç»æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œä½¿ç”¨é»˜è®¤ä»‹ç»`),{name:`å±•å“ ${e}`,content:`è¿™æ˜¯å±•å“${e}çš„é»˜è®¤ä»‹ç»ã€‚\n\nè¯¥å±•å“å±•ç¤ºäº†ç‹¬ç‰¹çš„3Dæ¨¡å‹ï¼Œå…·æœ‰ç²¾ç¾çš„ç»†èŠ‚å’Œè®¾è®¡ã€‚`}))}for(let e=0;e<20;e++){const o=e%5,t=Math.floor(e/5),n=18*o-36,i=startZ+18*t,a=e+1;loader.load(`3d_models/${a}.glb`,e=>{const o=e.scene;o.scale.setScalar(3),o.position.set(n,2,i),o.rotation.x=-.3,o.rotation.y=0,enhanceModelOnly(o),addModelSpecificLights(o);const t=(new THREE.Box3).setFromObject(o),s={model:o,modelIndex:a,position:{x:n,y:2,z:i},boundingBox:t,infoName:null,infoContent:null,infoLoaded:!1,lastCheckTime:0};glbModels.push(s),loadExhibitInfo(a).then(e=>{s.infoName=e.name,s.infoContent=e.content,s.infoLoaded=!0,console.log(`æ¨¡å‹${a}ï¼šä»‹ç»æ–‡æœ¬å·²åŠ è½½ - "${e.name}"`)}),scene.add(o),console.log(`æ¨¡å‹${a}ï¼šå·²åº”ç”¨ç»Ÿä¸€å€¾æ–œ${Math.round(-54/Math.PI)}åº¦`),onModelLoaded(`å±•å“${a}`)},e=>{console.log(`æ¨¡å‹${a}åŠ è½½è¿›åº¦ï¼š${Math.round(e.loaded/e.total*100)}%`)},e=>{console.log(`æ¨¡å‹${a}æœªæ‰¾åˆ°ï¼Œä½¿ç”¨è“è‰²æ–¹å—å…œåº•`,e);const o=new THREE.Mesh(exhibitGeo,exhibitMat);o.position.set(n,1.5,i),o.rotation.y=0,o.castShadow=!0,scene.add(o),onModelLoaded(`å±•å“${a}(å›é€€)`)})}const decorGeo=new THREE.BoxGeometry(1.2,1.2,1.2),decorMat=new THREE.MeshStandardMaterial({color:16763904,roughness:.5,metalness:.2}),decorPositions=[{x:groundBounds.minX+5,y:.6,z:groundBounds.minZ+5},{x:groundBounds.maxX-5,y:.6,z:groundBounds.minZ+5},{x:groundBounds.minX+5,y:.6,z:groundBounds.maxZ-5},{x:groundBounds.maxX-5,y:.6,z:groundBounds.maxZ-5}];decorPositions.forEach(e=>{const o=new THREE.Mesh(decorGeo,decorMat);o.position.set(e.x,e.y,e.z),o.castShadow=!0,scene.add(o)});const ambientLight=new THREE.AmbientLight(16777215,.6);scene.add(ambientLight);const dirLight=new THREE.DirectionalLight(16777215,.8);dirLight.position.set(-15,40,30),dirLight.castShadow=!0,dirLight.shadow.mapSize.width=1024,dirLight.shadow.mapSize.height=1024,dirLight.shadow.camera.near=1,dirLight.shadow.camera.far=150,dirLight.shadow.camera.left=-40,dirLight.shadow.camera.right=40,dirLight.shadow.camera.top=40,dirLight.shadow.camera.bottom=-40,scene.add(dirLight);const fillLight=new THREE.DirectionalLight(16777215,.3);fillLight.position.set(20,30,-20),fillLight.castShadow=!1,scene.add(fillLight);const exhibitInfo=document.getElementById("exhibitInfo"),exhibitInfoName=document.getElementById("exhibitInfoName"),exhibitInfoContent=document.getElementById("exhibitInfoContent"),raycaster=new THREE.Raycaster,mouse=new THREE.Vector2(0,0);let currentSelectedModel=null,hideTimer=null,frameCount=0;const CHECK_INTERVAL=5,MAX_DISTANCE=25;let lastIntersectResult=null,lastCheckTime=0;const detectionSpheres=[];function checkExhibitIntersection(){if("first"!==perspectiveMode)return void(currentSelectedModel&&hideExhibitInfo());if(frameCount++,frameCount%5!=0)return;const e=Date.now();if(currentSelectedModel&&e-lastCheckTime<200)return;lastCheckTime=e,raycaster.setFromCamera(mouse,camera);let o=null,t=1/0;if(0===detectionSpheres.length)for(const e of glbModels){const o=new THREE.Sphere;e.boundingBox.getBoundingSphere(o),o.radius*=1.2,detectionSpheres.push({sphere:o,modelInfo:e})}for(const e of detectionSpheres){const n=e.modelInfo;if(camera.position.distanceTo(new THREE.Vector3(n.position.x,n.position.y,n.position.z))>25)continue;const i=raycaster.ray.intersectSphere(e.sphere,new THREE.Vector3);if(i){const e=i.distanceTo(camera.position);e<t&&(t=e,o=n)}}o&&o!==currentSelectedModel?(hideTimer&&(clearTimeout(hideTimer),hideTimer=null),currentSelectedModel=o,showExhibitInfo(currentSelectedModel),lastIntersectResult=o):!o&&currentSelectedModel?hideTimer||(hideTimer=setTimeout(()=>{hideExhibitInfo(),currentSelectedModel=null,hideTimer=null,lastIntersectResult=null},1e3)):o&&o===currentSelectedModel&&hideTimer&&(clearTimeout(hideTimer),hideTimer=null)}function showExhibitInfo(e){e.infoLoaded?(exhibitInfoName.textContent=e.infoName,exhibitInfoContent.textContent=e.infoContent):(exhibitInfoName.textContent=`å±•å“ ${e.modelIndex}`,exhibitInfoContent.textContent="ä»‹ç»æ­£åœ¨åŠ è½½ä¸­..."),exhibitInfo.classList.add("show")}function hideExhibitInfo(){exhibitInfo.classList.remove("show")}let lastTime=0;const fpsLimit=60,frameTime=1e3/60;function animate(e){requestAnimationFrame(animate);const o=e-lastTime;o<frameTime||(lastTime=e-o%frameTime,updatePlayerMovement(),updateCamera(),checkExhibitIntersection(),renderer.render(scene,camera))}requestAnimationFrame(animate),window.addEventListener("resize",()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}),initBackgroundMusic(),updateCamera(),console.log("âœ… å±•å…å·²å¯åŠ¨ï¼ˆä¼˜åŒ–ç‰ˆäººç‰©æ¨¡å‹ï¼‰ï¼š"),console.log("ğŸ“Š æ€§èƒ½ä¼˜åŒ–è®¾ç½®ï¼š"),console.log("  - åƒç´ æ¯”å›ºå®š: 1.0"),console.log("  - æŠ—é”¯é½¿: å…³é—­"),console.log("  - æ¸²æŸ“ç²¾åº¦: lowp"),console.log("  - æ£€æµ‹é¢‘ç‡: æ¯5å¸§æ£€æµ‹ä¸€æ¬¡"),console.log("  - æœ€å¤§æ£€æµ‹è·ç¦»: 25å•ä½"),console.log("  - å¸§ç‡é™åˆ¶: 60FPS"),console.log("  - é˜´å½±åˆ†è¾¨ç‡: 1024x1024"),console.log("ğŸµ èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿï¼š"),console.log("  - éŸ³ä¹æ–‡ä»¶å¤¹: music"),console.log("  - è‡ªåŠ¨æ’­æ”¾: æ˜¯ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’åï¼‰"),console.log("  - å¾ªç¯æ’­æ”¾: æ˜¯"),console.log("  - éŸ³é‡: 50%"),console.log("ğŸ‘¤ äººç‰©æ¨¡å‹è®¾ç½®ï¼š"),console.log("  - æ¨¡å‹æ–‡ä»¶: 3d_models/character.glb"),console.log("  - æ¨¡å‹é«˜åº¦: -0.3ï¼ˆç¦»åœ°é¢è·ç¦»ï¼‰"),console.log("  - æ¨¡å‹æ—‹è½¬: 180åº¦"),console.log("  - ç¬¬ä¸€äººç§°è§†è§’: éšè—äººç‰©æ¨¡å‹"),console.log("  - ç¬¬ä¸‰äººç§°è§†è§’: æ˜¾ç¤ºäººç‰©æ¨¡å‹"),console.log("  - è‡ªå‘å…‰å¼ºåº¦: 0.3"),console.log("  - é˜´å½±: ç¦ç”¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰"),console.log("ğŸ“Š æ¨¡å‹å¢å¼ºå‚æ•°ï¼š"),console.log("  - è‡ªå‘å…‰å¼ºåº¦: 1.5"),console.log("  - æè´¨äº®åº¦æå‡: 5å€"),console.log("  - æ‰€æœ‰æ¨¡å‹ç»Ÿä¸€å€¾æ–œè§’åº¦: "+Math.round(-54/Math.PI)+"åº¦"),console.log("  - æ¯ä¸ªæ¨¡å‹æœ‰ä¸“å±å…‰æº"),console.log("  - å±•å“ä»‹ç»åŠŸèƒ½å·²å¯ç”¨ï¼ˆä»…ç¬¬ä¸€äººç§°è§†è§’ï¼Œå·²ä¼˜åŒ–æ€§èƒ½ï¼‰"),console.log("  - ä»‹ç»æ–‡æœ¬è·¯å¾„: introduction/"),console.log("  - TXTæ ¼å¼: ç¬¬ä¸€è¡Œä¸ºå±•å“åç§°ï¼Œå‰©ä½™ä¸ºä»‹ç»å†…å®¹")</script></body></html>
